# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø—Ä–æ–±–ª–µ–º —Å callback-–∞–º–∏ –≤ Telegram –±–æ—Ç–µ

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–Ø –¥–æ–±–∞–≤–∏–ª –æ–±—à–∏—Ä–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞ –∫–æ–¥–∞:

### 1. **–£–ª—É—á—à–µ–Ω–∏—è –≤ `src/handler.rs`:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ webhook –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º polling (–∫–æ–Ω—Ñ–ª–∏–∫—Ç webhook/polling)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ callback query —Å –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –≠–º–æ–¥–∑–∏-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤–∏–∑—É–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 2. **–£–ª—É—á—à–µ–Ω–∏—è –≤ `src/main.rs`:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –≤ –∫–∞–∂–¥—ã–π callback handler
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `answer_callback_query()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `RUST_LOG=debug` –≤ docker-compose.yml (–±—ã–ª–æ `info`)
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤ Dockerfile

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### üî¥ **–û–°–ù–û–í–ù–´–ï –ü–û–î–û–ó–†–ï–í–ê–ï–ú–´–ï:**

#### 1. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç Webhook/Polling**
**–°–∏–º–ø—Ç–æ–º—ã:** Callback-–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –Ω–æ `/start` —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `bot.delete_webhook()` –≤ –Ω–∞—á–∞–ª–µ

#### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ**
**–°–∏–º–ø—Ç–æ–º—ã:** –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
```
–£–¥–∞–ª—è–µ–º webhook (–µ—Å–ª–∏ –µ—Å—Ç—å)...
Webhook —É–¥–∞–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ
Polling listener —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
```

#### 3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
**–°–∏–º–ø—Ç–æ–º—ã:** Callback –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å N –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è callback
```

#### 4. **–û—à–∏–±–∫–∏ –≤ `answer_callback_query()`**
**–°–∏–º–ø—Ç–æ–º—ã:** –ö–Ω–æ–ø–∫–∏ "–ø–µ—Ä–µ–ª–∏–≤–∞—é—Ç—Å—è" –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
WOL Handler: –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback query
‚úÖ WOL Handler: Callback query –æ—Ç–≤–µ—á–µ–Ω
```

#### 5. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Telegram API**
**–°–∏–º–ø—Ç–æ–º—ã:** –ó–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –±–æ—Ç–∞
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å api.telegram.org

## –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
docker-compose down
docker-compose build --no-cache
docker-compose up
```

### –®–∞–≥ 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
docker logs -f tg-server-manager
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
=== –ù–ê–ß–ê–õ–û –ó–ê–ü–£–°–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–ê ===
–£–¥–∞–ª—è–µ–º webhook (–µ—Å–ª–∏ –µ—Å—Ç—å)...
Webhook —É–¥–∞–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ
Polling listener —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
–ó–∞–ø—É—Å–∫–∞–µ–º REPL...
```

### –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start
–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
```
=== –ü–û–õ–£–ß–ï–ù–û –û–ë–ù–û–í–õ–ï–ù–ò–ï ===
üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
üöÄ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É /start
üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞: [–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏]
‚úÖ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ
```

### –®–∞–≥ 5: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
```
=== –ü–û–õ–£–ß–ï–ù–û –û–ë–ù–û–í–õ–ï–ù–ò–ï ===
üîî –ü–æ–ª—É—á–µ–Ω CALLBACK QUERY!
üë§ –û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: [ID]
üìä Callback data: Some("[–¥–∞–Ω–Ω—ã–µ]")
üéØ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º callback data: '[–¥–∞–Ω–Ω—ã–µ]'
üîå –ó–∞–ø—É—Å–∫ WOL handler  (–∏–ª–∏ –¥—Ä—É–≥–æ–π handler)
üîå WOL Handler: –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
üîå WOL Handler: –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback query
‚úÖ WOL Handler: Callback query –æ—Ç–≤–µ—á–µ–Ω
‚úÖ Callback handler '[–¥–∞–Ω–Ω—ã–µ]' –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ
```

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ù–µ—Ç –ª–æ–≥–æ–≤ –æ callback-–∞—Ö –≤–æ–æ–±—â–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ BOT_TOKEN –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ api.telegram.org

### –°—Ü–µ–Ω–∞—Ä–∏–π B: Callback –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –Ω–æ handler –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ
**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ALLOWED_USERS
2. –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö handlers

### –°—Ü–µ–Ω–∞—Ä–∏–π C: Handler –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –Ω–æ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç "–ø–µ—Ä–µ–ª–∏–≤–∞—Ç—å—Å—è"
**–ü—Ä–æ–±–ª–µ–º–∞:** `answer_callback_query()` –Ω–µ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ BOT_TOKEN

### –°—Ü–µ–Ω–∞—Ä–∏–π D: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ
**–°–∏–º–ø—Ç–æ–º—ã:** –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è "–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –∑–∞–≤–µ—Ä—à–∏–ª—Å—è!"
**–†–µ—à–µ–Ω–∏—è:**
1. –ò—â–∏—Ç–µ –ø–∞–Ω–∏–∫–∏ –∏–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤—ã—à–µ –≤ –ª–æ–≥–∞—Ö
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ç–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å BOT_TOKEN

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è webhook —á–µ—Ä–µ–∑ Telegram API:
```bash
curl "https://api.telegram.org/bot[BOT_TOKEN]/getWebhookInfo"
```

### –£–¥–∞–ª–µ–Ω–∏–µ webhook –≤—Ä—É—á–Ω—É—é:
```bash
curl "https://api.telegram.org/bot[BOT_TOKEN]/deleteWebhook"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Telegram API:
```bash
curl "https://api.telegram.org/bot[BOT_TOKEN]/getMe"
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **Webhook vs Polling:** –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç polling, webhook –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω
2. **answer_callback_query:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ callback
3. **RUST_LOG:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `debug` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
4. **network_mode: host:** –í docker-compose –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–∞—à–∏ –ª–æ–≥–∏ —Å—Ç–∞–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏, –∏ –≤—ã —Ç–æ—á–Ω–æ –ø–æ–π–º–µ—Ç–µ, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π.