# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–ø—É—Å–∫–æ–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã—è–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º —Ä–µ—Å—Ç–∞—Ä—Ç–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

### 1. üö® –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç .env —Ñ–∞–π–ª
**–ü—Ä–æ–±–ª–µ–º–∞**: –í workspace –Ω–µ—Ç —Ñ–∞–π–ª–∞ `.env`, –Ω–æ –æ–Ω —É–∫–∞–∑–∞–Ω –≤ `docker-compose.yml`
```yaml
env_file:
  - .env
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`

### 2. üö® –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞–ø–∫–∞ keys/
**–ü—Ä–æ–±–ª–µ–º–∞**: –í Dockerfile –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –ø–∞–ø–∫–∞ `keys/`, –Ω–æ –µ—ë –Ω–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ
```dockerfile
COPY keys /app/keys/
RUN chmod 600 /app/keys/*
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: Docker build –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –ø–∞–ø–∫—É, –Ω–æ SSH –∫–ª—é—á–∏ –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `keys/` –∏ –ø–æ–º–µ—Å—Ç–∏—Ç—å —Ç—É–¥–∞ SSH –∫–ª—é—á–∏

### 3. üö® –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–¥–∞–Ω—ã
–ò–∑ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ `Config::from_env()` –≤–∏–¥–Ω–æ, —á—Ç–æ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´:
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `ALLOWED_USERS` - —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `SERVER_MAC` - MAC –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è Wake-on-LAN

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π `context("BOT_TOKEN –ø—É—Å—Ç")` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º–∏

## –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
```bash
cp .env.example .env
```

–ó–∞—Ç–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
```env
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_botfather
ALLOWED_USERS=123456789,987654321  # –≤–∞—à–∏ Telegram ID
SERVER_MAC=aa:bb:cc:dd:ee:ff       # MAC –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É —Å SSH –∫–ª—é—á–∞–º–∏
```bash
mkdir keys
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–∏ SSH –∫–ª—é—á–∏ –≤ –ø–∞–ø–∫—É keys/
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–∂–∏–¥–∞—é—Ç—Å—è:
# - keys/id_router_vps_rsa_legacy (–¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞)
# - keys/id_rsa (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª—é—á–∞–º
```bash
chmod 600 keys/*
```

### –®–∞–≥ 4: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker logs tg-server-manager
```

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
```
–ó–∞–ø—É—Å–∫ WakeOnLanBot...
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker ps
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up` –±–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

### –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ Dockerfile
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ Dockerfile –ø—Ä–æ–≤–µ—Ä–∫–∏:
```dockerfile
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–π –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
RUN ls -la /app/keys/ || echo "–í–ù–ò–ú–ê–ù–ò–ï: –ü–∞–ø–∫–∞ keys –ø—É—Å—Ç–∞!"
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ main.rs
–í —Ñ—É–Ω–∫—Ü–∏–∏ `main()` —É–∂–µ –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
```rust
if let Err(e) = run().await {
    eprintln!("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {:#}", e);
    std::process::exit(1);
}
```

–≠—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö Docker.

### Health check –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `docker-compose.yml`:
```yaml
healthcheck:
  test: ["CMD", "ps", "aux", "|", "grep", "wakeonlan_bot"]
  interval: 30s
  timeout: 10s
  retries: 3
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤ - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (.env) –∏ SSH –∫–ª—é—á–µ–π. –ü–æ—Å–ª–µ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ.