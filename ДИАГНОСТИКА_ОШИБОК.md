# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ WakeOnLan Telegram Bot

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤ –±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

1. **–û—à–∏–±–∫–∏ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**:
   ```
   WARN  wakeonlan_bot > –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å uptime: invalid socket address syntax
   ERROR wakeonlan_bot > –û—à–∏–±–∫–∞ WOL: invalid socket address syntax
   ```

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫**: –ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

### üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1. –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: Invalid socket address syntax

**–ü—Ä–∏—á–∏–Ω–∞**: 
–ö–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `localhost` –∫–∞–∫ –∞–¥—Ä–µ—Å –¥–ª—è SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –Ω–æ —Ñ—É–Ω–∫—Ü–∏—è `.parse()` –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å `localhost:port` –≤ –≤–∞–ª–∏–¥–Ω—ã–π `SocketAddr`, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç IP –∞–¥—Ä–µ—Å.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ src/main.rs**:

```rust
// –§—É–Ω–∫—Ü–∏—è establish_ssh_connection (—Å—Ç—Ä–æ–∫–∏ ~290-320)
fn establish_ssh_connection(
    host: &str,
    port: u16,
    user: &str,
    key_path: &str,
    timeout: Duration,
) -> Result<Session> {
    log::info!("–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å {}:{}", host, port);
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º localhost –≤ 127.0.0.1 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
    let resolved_host = if host == "localhost" {
        "127.0.0.1"
    } else {
        host
    };
    
    let addr = format!("{}:{}", resolved_host, port);
    log::debug!("–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –∞–¥—Ä–µ—Å—É: {}", addr);
    
    let tcp = TcpStream::connect_timeout(
        &addr.parse()?,
        timeout,
    )?;
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}

// –§—É–Ω–∫—Ü–∏—è check_status (—Å—Ç—Ä–æ–∫–∏ ~560-580)
async fn check_status(config: Config) -> Result<String> {
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º localhost –≤ 127.0.0.1 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    let resolved_host = if config.server_ssh_host == "localhost" {
        "127.0.0.1"
    } else {
        &config.server_ssh_host
    };
    
    let addr = format!("{}:{}", resolved_host, config.server_ssh_port);
    log::debug!("–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ –∞–¥—Ä–µ—Å—É: {}", addr);
    
    match tokio::net::TcpStream::connect(addr.clone()).await {
        // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
    }
}
```

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ .env

**–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —Ñ–∞–π–ª `.env` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.env` —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

```env
# Wake-on-LAN Telegram Bot Configuration

# Required Configuration
BOT_TOKEN=your_bot_token_from_botfather
ALLOWED_USERS=758356348
SERVER_MAC=aa:bb:cc:dd:ee:ff

# SSH Configuration
ROUTER_SSH_HOST=127.0.0.1
ROUTER_SSH_PORT=2223
ROUTER_SSH_USER=root
ROUTER_SSH_KEY_PATH=/app/keys/id_router_vps_rsa_legacy

SERVER_SSH_HOST=127.0.0.1
SERVER_SSH_PORT=2222
SERVER_SSH_USER=friedcerebrum
SERVER_SSH_KEY_PATH=/app/keys/id_rsa

# Timeout Configuration (in seconds)
SSH_TIMEOUT=15
NC_TIMEOUT=5

# Logging Configuration
RUST_LOG=info
```

#### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:
```bash
sudo apt update && sudo apt install -y libssl-dev pkg-config libssh2-1-dev
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "invalid socket address syntax"** - —Ç–µ–ø–µ—Ä—å `localhost` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `127.0.0.1`
2. **–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ IP –∞–¥—Ä–µ—Å–∞–º–∏ –≤–º–µ—Å—Ç–æ hostname
3. **–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è** –±–µ–∑ –æ—à–∏–±–æ–∫
4. **SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª
–ó–∞–º–µ–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ:

```env
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather –≤ Telegram
BOT_TOKEN=your_actual_bot_token

# –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π MAC –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
SERVER_MAC=aa:bb:cc:dd:ee:ff

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ SSH –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
ROUTER_SSH_HOST=192.168.1.1  # IP –≤–∞—à–µ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
SERVER_SSH_HOST=192.168.1.100  # IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á–∏
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –∫–ª—é—á–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø—É—Ç—è–º:
- `/app/keys/id_router_vps_rsa_legacy` (–¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞)
- `/app/keys/id_rsa` (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –ø–æ SSH:
```bash
ssh -i /app/keys/id_rsa friedcerebrum@127.0.0.1 -p 2222
ssh -i /app/keys/id_router_vps_rsa_legacy root@127.0.0.1 -p 2223
```

## üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
source /usr/local/cargo/env
./target/release/wakeonlan_bot
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏:
- –£—Å–ø–µ—à–Ω—ã–µ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ callback query

–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```env
RUST_LOG=debug
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:
- –ü—Ä–æ–±–ª–µ–º—ã —Å SSH –∫–ª—é—á–∞–º–∏
- –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å Wake-on-LAN –ø–∞–∫–µ—Ç–∞–º–∏
- –û—à–∏–±–∫–∏ Telegram API