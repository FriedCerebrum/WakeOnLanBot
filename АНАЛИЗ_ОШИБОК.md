# –ê–ù–ê–õ–ò–ó –û–®–ò–ë–û–ö –í TELEGRAM –ë–û–¢–ï

## üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –ù–ê–ô–î–ï–ù–´:

### 1. ‚ùå –û–®–ò–ë–ö–ê –ö–û–ú–ü–ò–õ–Ø–¶–ò–ò - Borrow of moved value
**–§–∞–π–ª:** `src/handler.rs:38`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `allowed_updates` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
```rust
// –°—Ç—Ä–æ–∫–∞ 25: —Å–æ–∑–¥–∞–µ—Ç—Å—è Vec
let allowed_updates = vec![...];
// –°—Ç—Ä–æ–∫–∞ 33: –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è
.allowed_updates(allowed_updates) 
// –°—Ç—Ä–æ–∫–∞ 38: –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
println!("üìã –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {:?}", allowed_updates);
```
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ

### 2. ‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –° –û–ë–†–ê–ë–û–¢–ö–û–ô –ö–ù–û–ü–û–ö:

#### 2.1 –ü—Ä–æ–±–ª–µ–º—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
- –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—ã–∑—ã–≤–∞—é—Ç `bot.answer_callback_query(&q.id).await?` –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ callback queries
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫

#### 2.2 –ü—Ä–æ–±–ª–µ–º—ã —Å –±–ª–æ–∫–∏—Ä—É—é—â–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏:
```rust
// –í main.rs —Å—Ç—Ä–æ–∫–∏ 252-258, 305-311, 362-368
match tokio::task::spawn_blocking({
    let cfg = config.clone();
    move || send_wol(&cfg)  // –ë–ª–æ–∫–∏—Ä—É—é—â–∞—è SSH –æ–ø–µ—Ä–∞—Ü–∏—è
}).await?
```
**–ü—Ä–æ–±–ª–µ–º–∞:** SSH –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –±–ª–æ–∫–∏—Ä—É—é—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ç–∞–π–º–∞—É—Ç—ã

#### 2.3 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∫–Ω–æ–ø–æ–∫:
- –ù–µ—Ç –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –∏ —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 3. üîí –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:

#### 3.1 SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
```rust
sess.userauth_pubkey_file(
    &config.router_ssh_user,
    None,  // –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç passphrase –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
    Path::new(&config.router_ssh_key),
    None,
)?;
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π –ø–∞—Ä–æ–ª–µ–º

#### 3.2 –ñ–µ—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```rust
ch.exec(&format!("etherwake -i br-lan {}", config.server_mac))?;  // WOL
ch.exec("sudo /sbin/shutdown -h now")?;  // Shutdown
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥—ã –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º MAC –∞–¥—Ä–µ—Å–µ

### 4. üö® –ü–†–û–ë–õ–ï–ú–´ –° –û–ë–†–ê–ë–û–¢–ö–û–ô –û–®–ò–ë–û–ö:

#### 4.1 –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ callback handlers:
```rust
// –í —Ä–∞–∑–Ω—ã—Ö handlers —Ä–∞–∑–ª–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
if let Some(msg) = &q.message {
    bot.edit_message_text(msg.chat.id, msg.id, format!("‚ùå –û—à–∏–±–∫–∞: {}", e)).await?;
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

#### 4.2 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ SSH:
- SSH –æ—à–∏–±–∫–∏ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ
- –°–ª–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 5. üîß –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

#### 5.1 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:
- –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ `send_wol`, `send_shutdown`, `check_status`
- –û–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ error handling –≤ callback handlers

#### 5.2 –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞:
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –ù–µ—Ç –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 6. üì± –ü–†–û–ë–õ–ï–ú–´ UX:

#### 6.1 –ö–Ω–æ–ø–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–í–∫–ª—é—á–∏—Ç—å" –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
- –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### 6.2 –¢–∞–π–º–∞—É—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:
```rust
ssh_timeout: Duration::from_secs(10),  // –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è SSH
nc_timeout: Duration::from_secs(3),    // –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
```

## üõ†Ô∏è –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:** –û—à–∏–±–∫—É –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ borrow checker
2. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ SSH –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –î–æ–±–∞–≤–∏—Ç—å –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥ –∫–Ω–æ–ø–æ–∫
4. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:** 1 (–Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è)
- **–°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:** 5 (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
- **–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 6 (UX, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- **–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∫–æ–¥–∞:** ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ (3/5)